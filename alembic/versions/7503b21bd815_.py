"""empty message

Revision ID: 7503b21bd815
Revises:
Create Date: 2024-10-30 06:42:35.175757

"""

from typing import Sequence, Union

import sqlalchemy as sa
import sqlmodel

from alembic import op

# revision identifiers, used by Alembic.
revision: str = "7503b21bd815"
down_revision: Union[str, None] = None
branch_labels: Union[str, Sequence[str], None] = None
depends_on: Union[str, Sequence[str], None] = None


def upgrade() -> None:
    # ### commands auto generated by Alembic - please adjust! ###
    achievements_table = op.create_table(
        "achievements",
        sa.Column("id", sa.Integer(), nullable=False),
        sa.Column("name", sqlmodel.sql.sqltypes.AutoString(), nullable=False),
        sa.Column("description", sqlmodel.sql.sqltypes.AutoString(length=10000), nullable=True),
        sa.Column("verb", sqlmodel.sql.sqltypes.AutoString(), nullable=False),
        sa.Column("image_url", sqlmodel.sql.sqltypes.AutoString(), nullable=True),
        sa.PrimaryKeyConstraint("id"),
    )
    attendance_types_table = op.create_table(
        "attendance_types",
        sa.Column("id", sa.Integer(), nullable=False),
        sa.Column("type", sqlmodel.sql.sqltypes.AutoString(), nullable=False),
        sa.Column("description", sqlmodel.sql.sqltypes.AutoString(length=10000), nullable=True),
        sa.PrimaryKeyConstraint("id"),
    )
    event_categories_table = op.create_table(
        "event_categories",
        sa.Column("id", sa.Integer(), nullable=False),
        sa.Column("name", sqlmodel.sql.sqltypes.AutoString(), nullable=False),
        sa.Column("description", sqlmodel.sql.sqltypes.AutoString(length=10000), nullable=True),
        sa.PrimaryKeyConstraint("id"),
    )
    event_tags_table = op.create_table(
        "event_tags",
        sa.Column("id", sa.Integer(), nullable=False),
        sa.Column("name", sqlmodel.sql.sqltypes.AutoString(), nullable=False),
        sa.Column("description", sqlmodel.sql.sqltypes.AutoString(length=10000), nullable=True),
        sa.Column("color", sqlmodel.sql.sqltypes.AutoString(), nullable=True),
        sa.PrimaryKeyConstraint("id"),
    )
    org_types_table = op.create_table(
        "org_types",
        sa.Column("id", sa.Integer(), nullable=False),
        sa.Column("name", sqlmodel.sql.sqltypes.AutoString(), nullable=False),
        sa.PrimaryKeyConstraint("id"),
    )
    permissions_table = op.create_table(
        "permissions",
        sa.Column("id", sa.Integer(), nullable=False),
        sa.Column("name", sqlmodel.sql.sqltypes.AutoString(), nullable=False),
        sa.Column("description", sqlmodel.sql.sqltypes.AutoString(length=10000), nullable=True),
        sa.PrimaryKeyConstraint("id"),
    )
    roles_table = op.create_table(
        "roles",
        sa.Column("id", sa.Integer(), nullable=False),
        sa.Column("name", sqlmodel.sql.sqltypes.AutoString(), nullable=False),
        sa.Column("description", sqlmodel.sql.sqltypes.AutoString(length=10000), nullable=True),
        sa.PrimaryKeyConstraint("id"),
    )
    op.create_table(
        "slack_spaces",
        sa.Column("team_id", sqlmodel.sql.sqltypes.AutoString(), nullable=False),
        sa.Column("workspace_name", sqlmodel.sql.sqltypes.AutoString(), nullable=True),
        sa.Column("bot_token", sqlmodel.sql.sqltypes.AutoString(), nullable=True),
        sa.Column("settings", sa.JSON(), nullable=True),
        sa.PrimaryKeyConstraint("team_id"),
    )
    event_types_table = op.create_table(
        "event_types",
        sa.Column("id", sa.Integer(), nullable=False),
        sa.Column("name", sqlmodel.sql.sqltypes.AutoString(), nullable=False),
        sa.Column("category_id", sa.Integer(), nullable=False),
        sa.Column("description", sqlmodel.sql.sqltypes.AutoString(length=10000), nullable=True),
        sa.Column("acronym", sqlmodel.sql.sqltypes.AutoString(), nullable=True),
        sa.ForeignKeyConstraint(
            ["category_id"],
            ["event_categories.id"],
        ),
        sa.PrimaryKeyConstraint("id"),
    )
    orgs_table = op.create_table(
        "orgs",
        sa.Column("id", sa.Integer(), nullable=False),
        sa.Column("parent_id", sa.Integer(), nullable=True),
        sa.Column("org_type_id", sa.Integer(), nullable=False),
        sa.Column("default_location_id", sa.Integer(), nullable=True),
        sa.Column("name", sqlmodel.sql.sqltypes.AutoString(), nullable=False),
        sa.Column("description", sqlmodel.sql.sqltypes.AutoString(length=10000), nullable=True),
        sa.Column("is_active", sa.Boolean(), nullable=False),
        sa.Column("logo", sa.LargeBinary(), nullable=True),
        sa.Column("website", sqlmodel.sql.sqltypes.AutoString(), nullable=True),
        sa.Column("email", sqlmodel.sql.sqltypes.AutoString(), nullable=True),
        sa.Column("twitter", sqlmodel.sql.sqltypes.AutoString(), nullable=True),
        sa.Column("facebook", sqlmodel.sql.sqltypes.AutoString(), nullable=True),
        sa.Column("instagram", sqlmodel.sql.sqltypes.AutoString(), nullable=True),
        sa.Column("last_annual_review", sa.Date(), nullable=True),
        sa.Column("meta", sa.JSON(), nullable=True),
        sa.ForeignKeyConstraint(
            ["org_type_id"],
            ["org_types.id"],
        ),
        sa.ForeignKeyConstraint(
            ["parent_id"],
            ["orgs.id"],
        ),
        sa.PrimaryKeyConstraint("id"),
    )
    roles_x_permissions_table = op.create_table(
        "roles_x_permissions",
        sa.Column("id", sa.Integer(), nullable=False),
        sa.Column("role_id", sa.Integer(), nullable=False),
        sa.Column("permission_id", sa.Integer(), nullable=False),
        sa.ForeignKeyConstraint(
            ["permission_id"],
            ["permissions.id"],
        ),
        sa.ForeignKeyConstraint(
            ["role_id"],
            ["roles.id"],
        ),
        sa.PrimaryKeyConstraint("id"),
    )
    op.create_table(
        "achievements_x_orgs",
        sa.Column("id", sa.Integer(), nullable=False),
        sa.Column("achievement_id", sa.Integer(), nullable=False),
        sa.Column("org_id", sa.Integer(), nullable=False),
        sa.ForeignKeyConstraint(
            ["achievement_id"],
            ["achievements.id"],
        ),
        sa.ForeignKeyConstraint(
            ["org_id"],
            ["orgs.id"],
        ),
        sa.PrimaryKeyConstraint("id"),
    )
    event_tags_x_org_table = op.create_table(
        "event_tags_x_org",
        sa.Column("id", sa.Integer(), nullable=False),
        sa.Column("event_tag_id", sa.Integer(), nullable=False),
        sa.Column("org_id", sa.Integer(), nullable=False),
        sa.Column("color_override", sqlmodel.sql.sqltypes.AutoString(), nullable=True),
        sa.ForeignKeyConstraint(
            ["event_tag_id"],
            ["event_tags.id"],
        ),
        sa.ForeignKeyConstraint(
            ["org_id"],
            ["orgs.id"],
        ),
        sa.PrimaryKeyConstraint("id"),
    )
    event_types_x_org_table = op.create_table(
        "event_types_x_org",
        sa.Column("id", sa.Integer(), nullable=False),
        sa.Column("event_type_id", sa.Integer(), nullable=False),
        sa.Column("org_id", sa.Integer(), nullable=False),
        sa.Column("is_default", sa.Boolean(), nullable=False),
        sa.ForeignKeyConstraint(
            ["event_type_id"],
            ["event_types.id"],
        ),
        sa.ForeignKeyConstraint(
            ["org_id"],
            ["orgs.id"],
        ),
        sa.PrimaryKeyConstraint("id"),
    )
    op.create_table(
        "locations",
        sa.Column("id", sa.Integer(), nullable=False),
        sa.Column("org_id", sa.Integer(), nullable=True),
        sa.Column("name", sqlmodel.sql.sqltypes.AutoString(), nullable=False),
        sa.Column("description", sqlmodel.sql.sqltypes.AutoString(), nullable=True),
        sa.Column("is_active", sa.Boolean(), nullable=False),
        sa.Column("lat", sa.Float(), nullable=True),
        sa.Column("lon", sa.Float(), nullable=True),
        sa.Column("address_street", sqlmodel.sql.sqltypes.AutoString(), nullable=True),
        sa.Column("address_city", sqlmodel.sql.sqltypes.AutoString(), nullable=True),
        sa.Column("address_state", sqlmodel.sql.sqltypes.AutoString(), nullable=True),
        sa.Column("address_zip", sqlmodel.sql.sqltypes.AutoString(), nullable=True),
        sa.Column("meta", sa.JSON(), nullable=True),
        sa.ForeignKeyConstraint(
            ["org_id"],
            ["orgs.id"],
        ),
        sa.PrimaryKeyConstraint("id"),
    )
    op.create_table(
        "orgs_x_slack",
        sa.Column("id", sa.Integer(), nullable=False),
        sa.Column("org_id", sa.Integer(), nullable=False),
        sa.Column("slack_id", sqlmodel.sql.sqltypes.AutoString(), nullable=False),
        sa.ForeignKeyConstraint(
            ["org_id"],
            ["orgs.id"],
        ),
        sa.PrimaryKeyConstraint("id"),
    )
    op.create_table(
        "users",
        sa.Column("id", sa.Integer(), nullable=False),
        sa.Column("f3_name", sqlmodel.sql.sqltypes.AutoString(), nullable=False),
        sa.Column("email", sqlmodel.sql.sqltypes.AutoString(), nullable=False),
        sa.Column("home_region_id", sa.Integer(), nullable=True),
        sa.Column("avatar_url", sqlmodel.sql.sqltypes.AutoString(), nullable=True),
        sa.Column("meta", sa.JSON(), nullable=True),
        sa.ForeignKeyConstraint(
            ["home_region_id"],
            ["orgs.id"],
        ),
        sa.PrimaryKeyConstraint("id"),
        sa.UniqueConstraint("email"),
    )
    op.create_table(
        "achievements_x_users",
        sa.Column("id", sa.Integer(), nullable=False),
        sa.Column("achievement_id", sa.Integer(), nullable=False),
        sa.Column("user_id", sa.Integer(), nullable=False),
        sa.Column("date_awarded", sa.Date(), nullable=False),
        sa.ForeignKeyConstraint(
            ["achievement_id"],
            ["achievements.id"],
        ),
        sa.ForeignKeyConstraint(
            ["user_id"],
            ["users.id"],
        ),
        sa.PrimaryKeyConstraint("id"),
    )
    op.create_table(
        "events",
        sa.Column("id", sa.Integer(), nullable=False),
        sa.Column("org_id", sa.Integer(), nullable=True),
        sa.Column("location_id", sa.Integer(), nullable=True),
        sa.Column("event_type_id", sa.Integer(), nullable=True),
        sa.Column("event_tag_id", sa.Integer(), nullable=True),
        sa.Column("series_id", sa.Integer(), nullable=True),
        sa.Column("is_series", sa.Boolean(), nullable=False),
        sa.Column("is_active", sa.Boolean(), nullable=False),
        sa.Column("highlight", sa.Boolean(), nullable=False),
        sa.Column("start_date", sa.Date(), nullable=False),
        sa.Column("end_date", sa.Date(), nullable=True),
        sa.Column("start_time", sa.Time(), nullable=True),
        sa.Column("end_time", sa.Time(), nullable=True),
        sa.Column("day_of_week", sa.Integer(), nullable=True),
        sa.Column("name", sqlmodel.sql.sqltypes.AutoString(), nullable=False),
        sa.Column("description", sqlmodel.sql.sqltypes.AutoString(), nullable=True),
        sa.Column("recurrence_pattern", sqlmodel.sql.sqltypes.AutoString(), nullable=True),
        sa.Column("recurrence_interval", sa.Integer(), nullable=True),
        sa.Column("index_within_interval", sa.Integer(), nullable=True),
        sa.Column("pax_count", sa.Integer(), nullable=True),
        sa.Column("fng_count", sa.Integer(), nullable=True),
        sa.Column("preblast", sqlmodel.sql.sqltypes.AutoString(), nullable=True),
        sa.Column("backblast", sqlmodel.sql.sqltypes.AutoString(), nullable=True),
        sa.Column("preblast_rich", sa.JSON(), nullable=True),
        sa.Column("backblast_rich", sa.JSON(), nullable=True),
        sa.Column("preblast_ts", sa.DateTime(), nullable=True),
        sa.Column("backblast_ts", sa.DateTime(), nullable=True),
        sa.Column("meta", sa.JSON(), nullable=True),
        sa.ForeignKeyConstraint(
            ["event_tag_id"],
            ["event_tags.id"],
        ),
        sa.ForeignKeyConstraint(
            ["event_type_id"],
            ["event_types.id"],
        ),
        sa.ForeignKeyConstraint(
            ["location_id"],
            ["locations.id"],
        ),
        sa.ForeignKeyConstraint(
            ["org_id"],
            ["orgs.id"],
        ),
        sa.ForeignKeyConstraint(
            ["series_id"],
            ["events.id"],
        ),
        sa.PrimaryKeyConstraint("id"),
    )
    op.create_table(
        "roles_x_users_x_orgs",
        sa.Column("id", sa.Integer(), nullable=False),
        sa.Column("role_id", sa.Integer(), nullable=False),
        sa.Column("user_id", sa.Integer(), nullable=False),
        sa.Column("org_id", sa.Integer(), nullable=False),
        sa.ForeignKeyConstraint(
            ["org_id"],
            ["orgs.id"],
        ),
        sa.ForeignKeyConstraint(
            ["role_id"],
            ["roles.id"],
        ),
        sa.ForeignKeyConstraint(
            ["user_id"],
            ["users.id"],
        ),
        sa.PrimaryKeyConstraint("id"),
        sa.UniqueConstraint("role_id", "user_id", "org_id", name="_role_user_org_uc"),
    )
    op.create_table(
        "slack_users",
        sa.Column("id", sa.Integer(), nullable=False),
        sa.Column("slack_id", sqlmodel.sql.sqltypes.AutoString(), nullable=False),
        sa.Column("user_name", sqlmodel.sql.sqltypes.AutoString(), nullable=False),
        sa.Column("email", sqlmodel.sql.sqltypes.AutoString(), nullable=False),
        sa.Column("is_admin", sa.Boolean(), nullable=False),
        sa.Column("is_owner", sa.Boolean(), nullable=False),
        sa.Column("is_bot", sa.Boolean(), nullable=False),
        sa.Column("user_id", sa.Integer(), nullable=False),
        sa.Column("avatar_url", sqlmodel.sql.sqltypes.AutoString(), nullable=True),
        sa.Column("slack_team_id", sqlmodel.sql.sqltypes.AutoString(), nullable=False),
        sa.Column("strava_access_token", sqlmodel.sql.sqltypes.AutoString(), nullable=True),
        sa.Column("strava_refresh_token", sqlmodel.sql.sqltypes.AutoString(), nullable=True),
        sa.Column("strava_expires_at", sa.DateTime(), nullable=True),
        sa.Column("strava_athlete_id", sa.Integer(), nullable=True),
        sa.Column("meta", sa.JSON(), nullable=True),
        sa.Column("slack_updated", sa.DateTime(), nullable=True),
        sa.ForeignKeyConstraint(
            ["user_id"],
            ["users.id"],
        ),
        sa.PrimaryKeyConstraint("id"),
    )
    op.create_table(
        "attendance",
        sa.Column("id", sa.Integer(), nullable=False),
        sa.Column("event_id", sa.Integer(), nullable=False),
        sa.Column("user_id", sa.Integer(), nullable=True),
        sa.Column("attendance_type_id", sa.Integer(), nullable=False),
        sa.Column("is_planned", sa.Boolean(), nullable=False),
        sa.Column("meta", sa.JSON(), nullable=True),
        sa.ForeignKeyConstraint(
            ["attendance_type_id"],
            ["attendance_types.id"],
        ),
        sa.ForeignKeyConstraint(
            ["event_id"],
            ["events.id"],
        ),
        sa.ForeignKeyConstraint(
            ["user_id"],
            ["users.id"],
        ),
        sa.PrimaryKeyConstraint("id"),
        sa.UniqueConstraint("event_id", "user_id", "attendance_type_id", "is_planned", name="event_user"),
    )
    # initializing some of the tables
    op.bulk_insert(
        table=org_types_table,
        rows=[
            {"name": "AO"},
            {"name": "Region"},
            {"name": "Area"},
            {"name": "Sector"},
        ],
    )
    op.bulk_insert(
        table=achievements_table,
        rows=[
            {
                "name": "The Priest",
                "description": "Post for 25 QSource lessons",
                "verb": "posting for 25 QSource lessons",
            },
            {
                "name": "The Monk",
                "description": "Post at 4 QSources in a month",
                "verb": "posting at 4 QSources in a month",
            },
            {
                "name": "Leader of Men",
                "description": "Q at 4 beatdowns in a month",
                "verb": "Qing at 4 beatdowns in a month",
            },
        ],
    )
    op.bulk_insert(
        table=event_categories_table,
        rows=[
            {"name": "1st F - Core Workout", "description": "The core F3 activity - must meet all 5 core principles."},
            {"name": "1st F - Pre Workout", "description": "Pre-workout activities (pre-rucks, pre-runs, etc)."},
            {
                "name": "1st F - Off the books",
                "description": "Fitness activities that didn't meet all 5 core principles (unscheduled, open to all men, etc).",  # noqa: E501
            },
            {"name": "2nd F - Fellowship", "description": "General category for 2nd F events."},
            {"name": "3rd F - Faith", "description": "General category for 3rd F events."},
        ],
    )
    op.bulk_insert(
        table=event_types_table,
        rows=[
            {"name": "Bootcamp", "category_id": 1, "acronym": "BC"},
            {"name": "Run", "category_id": 1, "acronym": "RU"},
            {"name": "Ruck", "category_id": 1, "acronym": "RK"},
            {"name": "QSource", "category_id": 3, "acronym": "QS"},
        ],
    )
    op.bulk_insert(
        table=attendance_types_table,
        rows=[
            {"type": "PAX"},
            {"type": "Q"},
            {"type": "Co-Q"},
        ],
    )
    op.bulk_insert(
        table=event_tags_table,
        rows=[
            {"name": "Open", "color": "Green"},
            {"name": "VQ", "color": "Blue"},
            {"name": "Manniversary", "color": "Yellow"},
            {"name": "Convergence", "color": "Orange"},
        ],
    )
    op.bulk_insert(
        table=permissions_table,
        rows=[
            {"name": "All"},
        ],
    )
    op.bulk_insert(
        table=roles_table,
        rows=[
            {"name": "Admin"},
        ],
    )
    op.bulk_insert(
        table=roles_x_permissions_table,
        rows=[
            {"role_id": 1, "permission_id": 1},
        ],
    )
    op.bulk_insert(
        table=orgs_table,
        rows=[
            {
                "org_type_id": 2,
                "name": "Example Region 1",
                "is_active": True,
            },
            {
                "org_type_id": 2,
                "name": "Example Region 2",
                "is_active": True,
            },
            {
                "org_type_id": 2,
                "name": "Example Region 3",
                "is_active": True,
            },
        ],
    )
    op.bulk_insert(
        table=event_types_x_org_table,
        rows=[{"event_type_id": i, "is_default": False, "org_id": j} for i in range(1, 5) for j in range(1, 4)],
    )
    op.bulk_insert(
        table=event_tags_x_org_table, rows=[{"event_tag_id": i, "org_id": j} for i in range(1, 5) for j in range(1, 4)]
    )
    # ### end Alembic commands ###


def downgrade() -> None:
    # ### commands auto generated by Alembic - please adjust! ###
    op.drop_table("attendance")
    op.drop_table("slack_users")
    op.drop_table("roles_x_users_x_orgs")
    op.drop_table("events")
    op.drop_table("achievements_x_users")
    op.drop_table("users")
    op.drop_table("orgs_x_slack")
    op.drop_table("locations")
    op.drop_table("event_types_x_org")
    op.drop_table("event_tags_x_org")
    op.drop_table("achievements_x_orgs")
    op.drop_table("roles_x_permissions")
    op.drop_table("orgs")
    op.drop_table("event_types")
    op.drop_table("slack_spaces")
    op.drop_table("roles")
    op.drop_table("permissions")
    op.drop_table("org_types")
    op.drop_table("event_tags")
    op.drop_table("event_categories")
    op.drop_table("attendance_types")
    op.drop_table("achievements")
    # ### end Alembic commands ###
